let d=[],o=[],m=0,i=null,c=!1,u=!1,g=!0;window.addEventListener("DOMContentLoaded",()=>{$.ajax({url:"/get-total-premios",type:"GET",timeout:-1,success:function(t){t&&Array.isArray(t.sorteables)&&Array.isArray(t.total)?(d=[...t.total],o=[...t.sorteables],h()):alert("Formato de datos inesperado o datos incompletos.")},error:function(t,e,a){console.error("Error en la solicitud:",a)}}),window.addEventListener("keydown",t=>{var e=document.getElementById("main-ruleta"),a=document.getElementById("main-premios"),n=document.getElementById("main-sorteado"),r=document.getElementById("main-fondo-principal");(t.code==="ArrowRight"||t.code==="ArrowLeft"||t.code==="Space")&&(t.preventDefault(),!e.classList.contains("d-none")&&o.length!==0?u&&(e.classList.add("d-none"),n.classList.remove("d-none"),f()):!c&&i===null?(r.classList.add("d-none"),p()):c&&o.length!==0&&g?(a.classList.add("d-none"),n.classList.add("d-none"),e.classList.remove("d-none"),u=!1,setTimeout(()=>{u=!0},1e3)):c&&o.length===0&&(a.classList.add("d-none"),n.classList.add("d-none"),e.classList.add("d-none"),r.classList.remove("d-none")))})});function p(){if(d.length===0)return;const t=document.querySelector("#card-container");i=setInterval(()=>{if(m>=d.length){clearInterval(i),i=null,c=!0;return}const e=d[m],a=document.createElement("div");a.className="col-md-2 mb-5 mt-5 card-wrapper";const n=document.createElement("div");e.sorteado===1?n.className="card h-100 red-card":n.className="card h-100",n.style.width="100%";const r=document.createElement("img");console.log(e.sorteado),e.sorteado===1?r.className="card-img-top grayscale":r.className="card-img-top",r.src="/images/"+e.codigo+".jpg",r.alt=`Imagen de ${e.descripcion}`;const s=document.createElement("div");s.className="card-body";const l=document.createElement("p");l.className="card-text",l.textContent=e.descripcion,s.appendChild(l),n.appendChild(r),n.appendChild(s),a.appendChild(n),t.appendChild(a),setTimeout(()=>{a.classList.add("visible")},100),m++},500)}function f(){if(o.length===0)return;g=!1,setTimeout(()=>{g=!0},5e3);const t=Math.floor(Math.random()*o.length),e=o[t],a=document.getElementById("premio-sorteado");a.innerHTML="";let n="/images/"+e.codigo+".jpg";a.innerHTML=`
        <img src="${n}" alt="Imagen de ${e.descripcion}">
        <div>${e.descripcion}</div>
    `,$.ajax({url:"/registrar-sorteado",type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{id:e.id},success:function(r){console.log("Premio registrado:",r)},error:function(r,s,l){console.error("Error al registrar el premio:",r)}}),o.splice(t,1)}function h(){if(d.length===0)return;const t=document.querySelector("#ruleta-premios");let e=0;setInterval(()=>{const a=d[e];let n="/images/"+a.codigo+".jpg";t.innerHTML=`
            <img src="${n}" alt="Imagen de ${a.descripcion}">
            <div>${a.descripcion}</div>
        `,e=(e+1)%d.length},110)}
